<!DOCTYPE html>
<html lang="en-us">

<head>
  

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>

<link rel="shortcut icon" type="image/png" href="/favicon.ico"/>


<link rel='stylesheet' href='/style.min.0122b8d14d9247c2ac34fa87ad975f23eb927ad958d8ae6bda2caccd9ac9eb42.css'>


<script src='/main.min.db37c27117ff8400e5e30549f6806d2bc825668b596d81316c6148417f59bc72.js' async></script>


  <title>Using the admin CLI - Mastodon documentation</title>

  <meta property="og:type" content="article">
  <meta property="og:url" content="https://docs.joinmastodon.org/admin/tootctl/">

  
    <meta name="description" content="tootctl commands that can be run from the CLI.">
    <meta property="og:description" content="tootctl commands that can be run from the CLI.">
    <meta name="twitter:description" content="tootctl commands that can be run from the CLI.">
  

  <meta name="twitter:title" content="Using the admin CLI">
  <meta name="twitter:site" content="@joinmastodon">

  <link rel="canonical" href="https://docs.joinmastodon.org/admin/tootctl/">
</head>

<body>
  <div class="container sidebar-layout">
    <nav class="sidebar"><a class="brand" href="/">
  <img class="link-logo" src="/brand.svg" alt="Mastodon" />
</a>

<input id="mobile-nav-toggle" class="mobile-nav-toggle" type="checkbox">
<label for="mobile-nav-toggle">
    <span class="menu-open">
        <i class="fa fa-times"></i> Close
    </span>
    <span class="menu-close">
        <i class="fa fa-bars"></i> Menu
    </span>
</label>

<ul>
  
  
    <li>
      
        <a href="/" class="">What is Mastodon?</a>
      

      
    </li>
  
    <li>
      
        <span class="sub-title">Using Mastodon</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/user/signup/" class="">Signing up for an account</a>

              
            </li>
          
            <li>
              <a href="/user/profile/" class="">Setting up your profile</a>

              
            </li>
          
            <li>
              <a href="/user/posting/" class="">Posting to your profile</a>

              
            </li>
          
            <li>
              <a href="/user/network/" class="">Using the network features</a>

              
            </li>
          
            <li>
              <a href="/user/moderating/" class="">Dealing with unwanted content</a>

              
            </li>
          
            <li>
              <a href="/user/discoverability/" class="">Promoting yourself and others</a>

              
            </li>
          
            <li>
              <a href="/user/preferences/" class="">Set your preferences</a>

              
            </li>
          
            <li>
              <a href="/user/contacts/" class="">More settings</a>

              
            </li>
          
            <li>
              <a href="/user/external/" class="">Using Mastodon externally</a>

              
            </li>
          
            <li>
              <a href="/user/moving/" class="">Moving or leaving accounts</a>

              
            </li>
          
            <li>
              <a href="/user/run-your-own/" class="">Running your own server</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">Running Mastodon</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/admin/prerequisites/" class="">Preparing your machine</a>

              
            </li>
          
            <li>
              <a href="/admin/install/" class="">Installing from source</a>

              
            </li>
          
            <li>
              <a href="/admin/config/" class="">Configuring your environment</a>

              
            </li>
          
            <li>
              <a href="/admin/elasticsearch/" class="">Configuring full-text search</a>

              
            </li>
          
            <li>
              <a href="/admin/optional/" class="">Installing optional features</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/admin/optional/object-storage/" class="">Object storage</a>
                    </li>
                  
                    <li>
                      <a href="/admin/optional/tor/" class="">Onion services</a>
                    </li>
                  
                    <li>
                      <a href="/admin/optional/captcha/" class="">Captcha</a>
                    </li>
                  
                    <li>
                      <a href="/admin/optional/sso/" class="">Single Sign On</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/admin/setup/" class="">Setting up your new instance</a>

              
            </li>
          
            <li>
              <a href="/admin/tootctl/" class="active">Using the admin CLI</a>

              
            </li>
          
            <li>
              <a href="/admin/upgrading/" class="">Upgrading to a new release</a>

              
            </li>
          
            <li>
              <a href="/admin/backups/" class="">Backing up your server</a>

              
            </li>
          
            <li>
              <a href="/admin/migrating/" class="">Migrating to a new machine</a>

              
            </li>
          
            <li>
              <a href="/admin/scaling/" class="">Scaling up your server</a>

              
            </li>
          
            <li>
              <a href="/admin/moderation/" class="">Moderation actions</a>

              
            </li>
          
            <li>
              <a href="/admin/troubleshooting/" class="">Troubleshooting errors</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/admin/troubleshooting/index-corruption/" class="">Database index corruption</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/admin/roles/" class="">Roles</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">Developing Mastodon apps</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/client/intro/" class="">Getting started with the API</a>

              
            </li>
          
            <li>
              <a href="/client/public/" class="">Playing with public data</a>

              
            </li>
          
            <li>
              <a href="/client/token/" class="">Obtaining client app access</a>

              
            </li>
          
            <li>
              <a href="/client/authorized/" class="">Logging in with an account</a>

              
            </li>
          
            <li>
              <a href="/client/libraries/" class="">Libraries and implementations</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">Contributing to Mastodon</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/dev/overview/" class="">Technical overview</a>

              
            </li>
          
            <li>
              <a href="/dev/setup/" class="">Setting up a dev environment</a>

              
            </li>
          
            <li>
              <a href="/dev/code/" class="">Code structure</a>

              
            </li>
          
            <li>
              <a href="/dev/routes/" class="">Routes</a>

              
            </li>
          
            <li>
              <a href="/dev/disclosure/" class="">Bug bounties and responsible disclosure</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">Spec compliance</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/spec/activitypub/" class="">ActivityPub</a>

              
            </li>
          
            <li>
              <a href="/spec/webfinger/" class="">WebFinger</a>

              
            </li>
          
            <li>
              <a href="/spec/security/" class="">Security</a>

              
            </li>
          
            <li>
              <a href="/spec/microformats/" class="">Microformats</a>

              
            </li>
          
            <li>
              <a href="/spec/oauth/" class="">OAuth</a>

              
            </li>
          
            <li>
              <a href="/spec/bearcaps/" class="">Bearcaps</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">REST API</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/api/guidelines/" class="">Guidelines and best practices</a>

              
            </li>
          
            <li>
              <a href="/api/oauth-scopes/" class="">OAuth Scopes</a>

              
            </li>
          
            <li>
              <a href="/api/rate-limits/" class="">Rate limits</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">API Methods</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/methods/apps/" class="">apps</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/oauth/" class="">oauth</a>
                    </li>
                  
                    <li>
                      <a href="/methods/emails/" class="">emails</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/accounts/" class="">accounts</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/bookmarks/" class="">bookmarks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/favourites/" class="">favourites</a>
                    </li>
                  
                    <li>
                      <a href="/methods/mutes/" class="">mutes</a>
                    </li>
                  
                    <li>
                      <a href="/methods/blocks/" class="">blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/domain_blocks/" class="">domain_blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/filters/" class="">filters</a>
                    </li>
                  
                    <li>
                      <a href="/methods/reports/" class="">reports</a>
                    </li>
                  
                    <li>
                      <a href="/methods/follow_requests/" class="">follow_requests</a>
                    </li>
                  
                    <li>
                      <a href="/methods/endorsements/" class="">endorsements</a>
                    </li>
                  
                    <li>
                      <a href="/methods/featured_tags/" class="">featured_tags</a>
                    </li>
                  
                    <li>
                      <a href="/methods/preferences/" class="">preferences</a>
                    </li>
                  
                    <li>
                      <a href="/methods/followed_tags/" class="">followed_tags</a>
                    </li>
                  
                    <li>
                      <a href="/methods/suggestions/" class="">suggestions</a>
                    </li>
                  
                    <li>
                      <a href="/methods/tags/" class="">tags</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/profile/" class="">profile</a>

              
            </li>
          
            <li>
              <a href="/methods/statuses/" class="">statuses</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/media/" class="">media</a>
                    </li>
                  
                    <li>
                      <a href="/methods/polls/" class="">polls</a>
                    </li>
                  
                    <li>
                      <a href="/methods/scheduled_statuses/" class="">scheduled_statuses</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/timelines/" class="">timelines</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/conversations/" class="">conversations</a>
                    </li>
                  
                    <li>
                      <a href="/methods/lists/" class="">lists</a>
                    </li>
                  
                    <li>
                      <a href="/methods/markers/" class="">markers</a>
                    </li>
                  
                    <li>
                      <a href="/methods/streaming/" class="">streaming</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/notifications/" class="">notifications</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/push/" class="">push</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/search/" class="">search</a>

              
            </li>
          
            <li>
              <a href="/methods/instance/" class="">instance</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/trends/" class="">trends</a>
                    </li>
                  
                    <li>
                      <a href="/methods/directory/" class="">directory</a>
                    </li>
                  
                    <li>
                      <a href="/methods/custom_emojis/" class="">custom_emojis</a>
                    </li>
                  
                    <li>
                      <a href="/methods/announcements/" class="">announcements</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/admin/" class="">admin</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/admin/accounts/" class="">accounts</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/canonical_email_blocks/" class="">canonical_email_blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/dimensions/" class="">dimensions</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/domain_allows/" class="">domain_allows</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/domain_blocks/" class="">domain_blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/email_domain_blocks/" class="">email_domain_blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/ip_blocks/" class="">ip_blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/measures/" class="">measures</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/reports/" class="">reports</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/retention/" class="">retention</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/trends/" class="">trends</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/proofs/" class="">proofs</a>

              
            </li>
          
            <li>
              <a href="/methods/oembed/" class="">oembed</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">API Entities</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/entities/Account/" class="">Account</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Account/" class="">Admin::Account</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_CanonicalEmailBlock/" class="">Admin::CanonicalEmailBlock</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Cohort/" class="">Admin::Cohort</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Dimension/" class="">Admin::Dimension</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_DomainAllow/" class="">Admin::DomainAllow</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_DomainBlock/" class="">Admin::DomainBlock</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_EmailDomainBlock/" class="">Admin::EmailDomainBlock</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Ip/" class="">Admin::Ip</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_IpBlock/" class="">Admin::IpBlock</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Measure/" class="">Admin::Measure</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Report/" class="">Admin::Report</a>

              
            </li>
          
            <li>
              <a href="/entities/Announcement/" class="">Announcement</a>

              
            </li>
          
            <li>
              <a href="/entities/Application/" class="">Application</a>

              
            </li>
          
            <li>
              <a href="/entities/Context/" class="">Context</a>

              
            </li>
          
            <li>
              <a href="/entities/Conversation/" class="">Conversation</a>

              
            </li>
          
            <li>
              <a href="/entities/CustomEmoji/" class="">CustomEmoji</a>

              
            </li>
          
            <li>
              <a href="/entities/DomainBlock/" class="">DomainBlock</a>

              
            </li>
          
            <li>
              <a href="/entities/Error/" class="">Error</a>

              
            </li>
          
            <li>
              <a href="/entities/ExtendedDescription/" class="">ExtendedDescription</a>

              
            </li>
          
            <li>
              <a href="/entities/FamiliarFollowers/" class="">FamiliarFollowers</a>

              
            </li>
          
            <li>
              <a href="/entities/FeaturedTag/" class="">FeaturedTag</a>

              
            </li>
          
            <li>
              <a href="/entities/Filter/" class="">Filter</a>

              
            </li>
          
            <li>
              <a href="/entities/FilterKeyword/" class="">FilterKeyword</a>

              
            </li>
          
            <li>
              <a href="/entities/FilterResult/" class="">FilterResult</a>

              
            </li>
          
            <li>
              <a href="/entities/FilterStatus/" class="">FilterStatus</a>

              
            </li>
          
            <li>
              <a href="/entities/IdentityProof/" class="">IdentityProof</a>

              
            </li>
          
            <li>
              <a href="/entities/Instance/" class="">Instance</a>

              
            </li>
          
            <li>
              <a href="/entities/List/" class="">List</a>

              
            </li>
          
            <li>
              <a href="/entities/Marker/" class="">Marker</a>

              
            </li>
          
            <li>
              <a href="/entities/MediaAttachment/" class="">MediaAttachment</a>

              
            </li>
          
            <li>
              <a href="/entities/Notification/" class="">Notification</a>

              
            </li>
          
            <li>
              <a href="/entities/Poll/" class="">Poll</a>

              
            </li>
          
            <li>
              <a href="/entities/Preferences/" class="">Preferences</a>

              
            </li>
          
            <li>
              <a href="/entities/PreviewCard/" class="">PreviewCard</a>

              
            </li>
          
            <li>
              <a href="/entities/Reaction/" class="">Reaction</a>

              
            </li>
          
            <li>
              <a href="/entities/Relationship/" class="">Relationship</a>

              
            </li>
          
            <li>
              <a href="/entities/RelationshipSeveranceEvent/" class="">RelationshipSeveranceEvent</a>

              
            </li>
          
            <li>
              <a href="/entities/Report/" class="">Report</a>

              
            </li>
          
            <li>
              <a href="/entities/Role/" class="">Role</a>

              
            </li>
          
            <li>
              <a href="/entities/Rule/" class="">Rule</a>

              
            </li>
          
            <li>
              <a href="/entities/ScheduledStatus/" class="">ScheduledStatus</a>

              
            </li>
          
            <li>
              <a href="/entities/Search/" class="">Search</a>

              
            </li>
          
            <li>
              <a href="/entities/Status/" class="">Status</a>

              
            </li>
          
            <li>
              <a href="/entities/StatusEdit/" class="">StatusEdit</a>

              
            </li>
          
            <li>
              <a href="/entities/StatusSource/" class="">StatusSource</a>

              
            </li>
          
            <li>
              <a href="/entities/Suggestion/" class="">Suggestion</a>

              
            </li>
          
            <li>
              <a href="/entities/Tag/" class="">Tag</a>

              
            </li>
          
            <li>
              <a href="/entities/Token/" class="">Token</a>

              
            </li>
          
            <li>
              <a href="/entities/Translation/" class="">Translation</a>

              
            </li>
          
            <li>
              <a href="/entities/V1_Filter/" class="">V1::Filter</a>

              
            </li>
          
            <li>
              <a href="/entities/V1_Instance/" class="">V1::Instance</a>

              
            </li>
          
            <li>
              <a href="/entities/WebPushSubscription/" class="">WebPushSubscription</a>

              
            </li>
          
        </ul>
      
    </li>
  
</ul>
</nav>
    <main>
  <h1>Using the admin CLI</h1>  
  
    <p>tootctl commands that can be run from the CLI.</p>
  
  <aside>
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#base-cli">Base CLI</a>
          <ul>
            <li><a href="#self-destruct"><code>tootctl self-destruct</code></a></li>
            <li><a href="#version"><code>tootctl --version</code></a></li>
          </ul>
        </li>
        <li><a href="#accounts">Accounts CLI</a>
          <ul>
            <li><a href="#accounts-rotate"><code>tootctl accounts rotate</code></a></li>
            <li><a href="#accounts-create"><code>tootctl accounts create</code></a></li>
            <li><a href="#accounts-modify"><code>tootctl accounts modify</code></a></li>
            <li><a href="#accounts-delete"><code>tootctl accounts delete</code></a></li>
            <li><a href="#accounts-backup"><code>tootctl accounts backup</code></a></li>
            <li><a href="#accounts-cull"><code>tootctl accounts cull</code></a></li>
            <li><a href="#accounts-refresh"><code>tootctl accounts refresh</code></a></li>
            <li><a href="#accounts-merge"><code>tootctl accounts merge</code></a></li>
            <li><a href="#accounts-follow"><code>tootctl accounts follow</code></a></li>
            <li><a href="#accounts-unfollow"><code>tootctl accounts unfollow</code></a></li>
            <li><a href="#accounts-reset-relationships"><code>tootctl accounts reset-relationships</code></a></li>
            <li><a href="#accounts-approve"><code>tootctl accounts approve</code></a></li>
            <li><a href="#accounts-prune"><code>tootctl accounts prune</code></a></li>
          </ul>
        </li>
        <li><a href="#cache">Cache CLI</a>
          <ul>
            <li><a href="#cache-clear"><code>tootctl cache clear</code></a></li>
            <li><a href="#cache-recount"><code>tootctl cache recount</code></a></li>
          </ul>
        </li>
        <li><a href="#domains">Domains CLI</a>
          <ul>
            <li><a href="#domains-purge"><code>tootctl domains purge</code></a></li>
            <li><a href="#domains-crawl"><code>tootctl domains crawl</code></a></li>
          </ul>
        </li>
        <li><a href="#email-domain-blocks">Email domain blocks CLI</a>
          <ul>
            <li><a href="#email-domain-blocks-list"><code>tootctl email-domain-blocks list</code></a></li>
            <li><a href="#email-domain-blocks-add"><code>tootctl email-domain-blocks add</code></a></li>
            <li><a href="#email-domain-blocks-remove"><code>tootctl email-domain-blocks remove</code></a></li>
          </ul>
        </li>
        <li><a href="#emoji">Emoji CLI</a>
          <ul>
            <li><a href="#emoji-export"><code>tootctl emoji export</code></a></li>
            <li><a href="#emoji-import"><code>tootctl emoji import</code></a></li>
            <li><a href="#emoji-purge"><code>tootctl emoji purge</code></a></li>
          </ul>
        </li>
        <li><a href="#feeds">Feeds CLI</a>
          <ul>
            <li><a href="#feeds-build"><code>tootctl feeds build</code></a></li>
            <li><a href="#feeds-clear"><code>tootctl feeds clear</code></a></li>
          </ul>
        </li>
        <li><a href="#maintenance">Maintenance CLI</a>
          <ul>
            <li><a href="#maintenance-fix-duplicates"><code>tootctl maintenance fix-duplicates</code></a></li>
          </ul>
        </li>
        <li><a href="#media">Media CLI</a>
          <ul>
            <li><a href="#media-remove"><code>tootctl media remove</code></a></li>
            <li><a href="#media-remove-orphans"><code>tootctl media remove-orphans</code></a></li>
            <li><a href="#media-refresh"><code>tootctl media refresh</code></a></li>
            <li><a href="#media-usage"><code>tootctl media usage</code></a></li>
            <li><a href="#media-lookup"><code>tootctl media lookup</code></a></li>
          </ul>
        </li>
        <li><a href="#preview_cards">Preview Cards CLI</a>
          <ul>
            <li><a href="#preview_cards-remove"><code>tootctl preview_cards remove</code></a></li>
          </ul>
        </li>
        <li><a href="#search">Search CLI</a>
          <ul>
            <li><a href="#search-deploy"><code>tootctl search deploy</code></a></li>
          </ul>
        </li>
        <li><a href="#settings">Settings CLI</a>
          <ul>
            <li><a href="#settings-registrations-open"><code>tootctl settings registrations open</code></a></li>
            <li><a href="#settings-registrations-close"><code>tootctl settings registrations close</code></a></li>
            <li><a href="#settings-registrations-approved"><code>tootctl settings registrations approved</code></a></li>
          </ul>
        </li>
        <li><a href="#statuses">Statuses CLI</a>
          <ul>
            <li><a href="#statuses-remove"><code>tootctl statuses remove</code></a></li>
          </ul>
        </li>
        <li><a href="#upgrade">Upgrade CLI</a>
          <ul>
            <li><a href="#upgrade-storage-schema"><code>tootctl upgrade storage-schema</code></a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </aside>
  <div class="e-content">
    <p>The command-line interface of Mastodon is an executable file called <code>tootctl</code> residing in the <code>bin</code> directory within the Mastodon root directory. You must specify which environment you intend to use whenever you execute it by specifying the <code>RAILS_ENV</code> environment variable. Unless you are a developer working on a local machine, you need to use <code>RAILS_ENV=production</code>. If you are sure that you will never need another environment (for development, testing, or staging), you can add it to your <code>.bashrc</code> file for convenience, e.g.:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;export RAILS_ENV=production&#34;</span> &gt;&gt; ~/.bashrc
</code></pre></div><p>If so, you won’t need to specify it each time inline. Otherwise, calls to <code>tootctl</code> will usually go like this, assuming that the Mastodon code is checked out in <code>/home/mastodon/live</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">cd</span> /home/mastodon/live
<span style="color:#8be9fd;font-style:italic">RAILS_ENV</span><span style="color:#ff79c6">=</span>production bin/tootctl <span style="color:#8be9fd;font-style:italic">help</span>
</code></pre></div><h2 id="base-cli">Base CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/base.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/base.rb
</a>

<hr>
<h3 id="self-destruct"><code>tootctl self-destruct</code></h3>
<p>Erase this server from the federation by broadcasting account Delete activities to all known other servers. This allows a &ldquo;clean exit&rdquo; from running a Mastodon server, as it leaves next to no cache behind on other servers. This command is always interactive and requires confirmation twice.</p>
<p>No local data is actually deleted because emptying the database or deleting the entire VPS is faster. If you run this command and then continue to operate the instance anyway, then there will be a state mismatch that might lead to glitches and issues with federation.</p>
<div class="hint hint-danger">
  <div class="hint-icon"><i class="fa fa-exclamation-triangle"></i></div>

  <strong>Make sure you know exactly what you are doing before running this command.</strong> This operation is NOT reversible, and it can take a long time. The server will be in a BROKEN STATE after this command finishes. A running Sidekiq process is required, so do not shut down the server until the queues are fully cleared.
</div>

<dl>
<dt><code>--dry-run</code></dt>
<dd>Print expected results only, without performing any actions.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.8.0 - added</p>
<hr>
<h3 id="version"><code>tootctl --version</code></h3>
<p>Show the version of the currently running Mastodon instance.</p>
<p><strong>Version history:</strong><br>
2.7.0 - added</p>
<hr>
<h2 id="accounts">Accounts CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/accounts.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/accounts.rb
</a>

<hr>
<h3 id="accounts-rotate"><code>tootctl accounts rotate</code></h3>
<p>Generate and broadcast new RSA keys, as part of security maintenance.</p>
<dl>
<dt><code>USERNAME</code></dt>
<dd>Local username for an account.</dd>
<dt><code>--all</code></dt>
<dd>Can be provided instead of <code>USERNAME</code> to rotate keys for all local accounts.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.5.0 - added</p>
<hr>
<h3 id="accounts-create"><code>tootctl accounts create</code></h3>
<p>Create a new user account with the given <code>USERNAME</code> and provided <code>--email</code>.</p>
<dl>
<dt><code>USERNAME</code></dt>
<dd>Local username for the new account. <span class="api-method-parameter-required">required</span></dd>
<dt><code>--email EMAIL</code></dt>
<dd>Email address to be attached to the user. <span class="api-method-parameter-required">required</span></dd>
<dt><code>--confirmed</code></dt>
<dd>Skip sending the confirmation email and activate the account immediately.</dd>
<dt><code>--role ROLE</code></dt>
<dd>Define the new account&rsquo;s custom role by providing the <code>name</code> of that <a href="/entities/Role/">Role</a>. Default roles include <code>Owner</code>, <code>Admin</code>, and <code>Moderator</code> (case-sensitive).</dd>
<dt><code>--reattach</code></dt>
<dd>Reuse an old USERNAME after its account has been deleted.</dd>
</dl>
<p><code>--force</code>
Forcefully delete any existing account with this <code>USERNAME</code> and reattach the new account in place of the (just-deleted) account.</p>
<dl>
<dt><code>--skip-sign-in-token</code></dt>
<dd>Forcefully ensure that the user is never asked for an e-mailed security code.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.6.0 - added<br>
4.0.0 - <code>--role</code> no longer takes hard-coded <code>user</code>, <code>moderator</code>, or <code>admin</code> roles. Specify the name of the custom Role instead (case-sensitive).</p>
<hr>
<h3 id="accounts-modify"><code>tootctl accounts modify</code></h3>
<p>Modify a user account&rsquo;s role, email, active status, approval mode, or 2FA requirement.</p>
<dl>
<dt><code>USERNAME</code></dt>
<dd>Local username for the account. <span class="api-method-parameter-required">required</span></dd>
<dt><code>--role ROLE</code></dt>
<dd>Define the existing account&rsquo;s custom role by providing the <code>name</code> of that <a href="/entities/Role/">Role</a>. Default roles include <code>Owner</code>, <code>Admin</code>, and <code>Moderator</code> (case-sensitive).</dd>
<dt><code>--remove-role</code></dt>
<dd>Removes the current role from the user.</dd>
<dt><code>--email EMAIL</code></dt>
<dd>Update the user&rsquo;s email address to <code>EMAIL</code>.</dd>
<dt><code>--confirm</code></dt>
<dd>Skip confirmation email, when used with <code>--email</code>.</dd>
<dt><code>--disable</code></dt>
<dd>Lock <code>USERNAME</code> out of their account.</dd>
<dt><code>--enable</code></dt>
<dd>Unlock <code>USERNAME</code>'s account if it is currently disabled.</dd>
<dt><code>--approve</code></dt>
<dd>Approve <code>USERNAME</code>'s account, if you are/were in approval mode.</dd>
<dt><code>--disable-2fa</code></dt>
<dd>Remove additional factors and allow login with a password.</dd>
<dt><code>--reset-password</code></dt>
<dd>Resets the password of the given account.</dd>
<dt><code>--skip-sign-in-token</code></dt>
<dd>Forcefully ensure that the user is never asked for an e-mailed security code.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.6.0 - added<br>
3.1.2 - added <code>--reset-password</code><br>
4.0.0 - <code>--role</code> no longer takes hard-coded <code>user</code>, <code>moderator</code>, or <code>admin</code> roles. Specify the name of the custom Role instead (case-sensitive). Remove the current role with <code>--remove-role</code>.</p>
<hr>
<h3 id="accounts-delete"><code>tootctl accounts delete</code></h3>
<p>Delete a user account with the given USERNAME.</p>
<dl>
<dt><code>USERNAME</code></dt>
<dd>Local username for the new account. <span class="api-method-parameter-required">required</span></dd>
</dl>
<p><strong>Version history:</strong><br>
2.6.0 - added</p>
<hr>
<h3 id="accounts-backup"><code>tootctl accounts backup</code></h3>
<p>Request a backup for a user account with the given USERNAME. The backup will be created in Sidekiq asynchronously, and the user will receive an email with a link to it once it&rsquo;s done.</p>
<dl>
<dt><code>USERNAME</code></dt>
<dd>Local username for the new account. <span class="api-method-parameter-required">required</span></dd>
</dl>
<p><strong>Version history:</strong><br>
2.6.0 - added</p>
<hr>
<h3 id="accounts-cull"><code>tootctl accounts cull</code></h3>
<p>Remove remote accounts that no longer exist. Queries every single remote account in the database to determine if it still exists on the origin server, and if it doesn&rsquo;t, then remove it from the database. Accounts that have had confirmed activity within the last week are excluded from the checks, in case the server is just down.</p>
<dl>
<dt><code>DOMAIN[...]</code></dt>
<dd>Optionally pass specific domains to cull</dd>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to N=5.</dd>
<dt><code>--dry-run</code></dt>
<dd>Print expected results only, without performing any actions.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.6.0 - added<br>
2.8.0 - add <code>--dry-run</code><br>
3.5.0 - add the ability to pass specific domains</p>
<hr>
<h3 id="accounts-refresh"><code>tootctl accounts refresh</code></h3>
<p>Refetch remote user data and files for one or multiple accounts.</p>
<dl>
<dt><code>USERNAME</code></dt>
<dd>username@domain for the remote account.</dd>
<dt><code>--all</code></dt>
<dd>Can be provided instead of <code>USERNAME</code> to refresh all remote accounts.</dd>
<dt><code>--domain DOMAIN</code></dt>
<dd>Can be provided instead of <code>USERNAME</code>. Operate only on remote accounts from this <code>DOMAIN</code>.</dd>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to N=5.</dd>
<dt><code>--verbose</code></dt>
<dd>Print additional information while a task is processing.</dd>
<dt><code>--dry-run</code></dt>
<dd>Print expected results only, without performing any actions.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.6.0 - added</p>
<hr>
<h3 id="accounts-merge"><code>tootctl accounts merge</code></h3>
<p>Merge two remote accounts into one. This is primarily meant to fix duplicates caused by other servers changing their domain. By default, this only works if the public key is the same, but this can be overridden.</p>
<dl>
<dt><code>FROM</code></dt>
<dd>username@domain for the remote account to be removed. <span class="api-method-parameter-required">required</span></dd>
<dt><code>TO</code></dt>
<dd>username@domain for the remote account to be kept. <span class="api-method-parameter-required">required</span></dd>
<dt><code>--force</code></dt>
<dd>Override the public key check.</dd>
</dl>
<p><strong>Version history:</strong><br>
3.3.0 - added</p>
<hr>
<h3 id="accounts-follow"><code>tootctl accounts follow</code></h3>
<p>Force all local accounts to follow a local account specified by username.</p>
<dl>
<dt><code>USERNAME</code></dt>
<dd>Local username. <span class="api-method-parameter-required">required</span></dd>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to N=5.</dd>
<dt><code>--verbose</code></dt>
<dd>Print additional information while task is processing.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.7.0 - added<br>
3.0.0 - now uses <code>USERNAME</code> instead of <code>ACCT</code></p>
<hr>
<h3 id="accounts-unfollow"><code>tootctl accounts unfollow</code></h3>
<p>Force all local accounts to unfollow an account specified by their address.</p>
<dl>
<dt><code>ACCT</code></dt>
<dd><code>username@domain</code> address. <span class="api-method-parameter-required">required</span></dd>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to N=5.</dd>
<dt><code>--verbose</code></dt>
<dd>Print additional information while task is processing.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.7.0 - added</p>
<hr>
<h3 id="accounts-reset-relationships"><code>tootctl accounts reset-relationships</code></h3>
<p>Reset all follow and/or follower relationships for a local account.</p>
<dl>
<dt><code>USERNAME</code></dt>
<dd>Local username.</dd>
<dt><code>--follows</code></dt>
<dd>Force <code>USERNAME</code> to unfollow everyone, then re-follow them.</dd>
<dt><code>--followers</code></dt>
<dd>Remove all of <code>USERNAME</code>'s followers.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.8.0 - added</p>
<hr>
<h3 id="accounts-approve"><code>tootctl accounts approve</code></h3>
<p>Approve new registrations when instance is in approval mode.</p>
<dl>
<dt><code>USERNAME</code></dt>
<dd>Local username.</dd>
<dt><code>--number N</code></dt>
<dd>Approve the N earliest pending registrations.</dd>
<dt><code>--all</code></dt>
<dd>Approve all pending registrations.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.8.0 - added</p>
<hr>
<h3 id="accounts-prune"><code>tootctl accounts prune</code></h3>
<p>Prune remote accounts that never interacted with local users</p>
<dl>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to N=5.</dd>
<dt><code>--dry-run</code></dt>
<dd>Print expected results only, without performing any actions.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.8.0 - added</p>
<hr>
<h2 id="cache">Cache CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/cache.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/cache.rb
</a>

<hr>
<h3 id="cache-clear"><code>tootctl cache clear</code></h3>
<p>Clear out the cache storage.</p>
<p><strong>Version history:</strong><br>
2.8.1 - added</p>
<hr>
<h3 id="cache-recount"><code>tootctl cache recount</code></h3>
<p>Update hard-cached counters of TYPE by counting referenced records from scratch. It may take a very long time to finish, depending on the size of the database. Accounts will have their follower, following, and status counts refreshed. Statuses will have their reply, boost, and favourite counts refreshed.</p>
<dl>
<dt><code>TYPE</code></dt>
<dd>Either <code>accounts</code> or <code>statuses</code>. <span class="api-method-parameter-required">required</span></dd>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to N=5.</dd>
<dt><code>--verbose</code></dt>
<dd>Print additional information while task is processing.</dd>
</dl>
<p><strong>Version history:</strong><br>
3.0.0 - added</p>
<hr>
<h2 id="domains">Domains CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/domains.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/domains.rb
</a>

<hr>
<h3 id="domains-purge"><code>tootctl domains purge</code></h3>
<p>Remove all accounts from a given DOMAIN without leaving behind any records. Unlike a suspension, if the DOMAIN still exists in the wild, it means the accounts could return if they are resolved again.</p>
<dl>
<dt><code>DOMAIN[...]</code></dt>
<dd>Domains to purge, separated by space.</dd>
<dt><code>--by-uri</code></dt>
<dd>Match domains in the actor URI rather than in the Webfinger address.</dd>
<dt><code>--limited-federation-mode</code></dt>
<dd>Can be provided instead of DOMAIN. Instead of purging from a single domain, all accounts from domains that are not allow-listed will be removed from the database. Use this after enabling limited federation mode and defining your allow-list.</dd>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to 5.</dd>
<dt><code>--verbose</code></dt>
<dd>Print additional information while task is processing.</dd>
<dt><code>--dry-run</code></dt>
<dd>Print expected results only, without performing any actions.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.6.0 - added<br>
2.8.0 - add <code>--whitelist-mode</code><br>
2.9.0 - remove custom emoji as well<br>
3.0.0 - accept multiple domains<br>
3.2.0 - rename <code>--whitelist-mode</code> to <code>--limited-federation-mode</code><br>
3.5.0 - add <code>--by-uri</code></p>
<hr>
<h3 id="domains-crawl"><code>tootctl domains crawl</code></h3>
<p>Crawl the known fediverse by using Mastodon REST API endpoints that expose all known peers, and collect statistics from those peers, as long as those peers support those API endpoints. When no START is given, the command uses the server&rsquo;s own database of known peers to seed the crawl. Returns total servers, total registered users, total active users in the last week, and total users joined in the last week.</p>
<dl>
<dt><code>START</code></dt>
<dd>Optionally start from a different domain name.</dd>
<dt><code>--exclude-suspended</code></dt>
<dd>Do not include instances that you have suspended in the output. Also includes any subdomains.</dd>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to N=50.</dd>
<dt><code>--format FORMAT</code></dt>
<dd>Control how results are returned. <code>summary</code> will print a summary. <code>domains</code> will return a newline-delimited list of all discovered peers. <code>json</code> will dump aggregated raw data. Defaults to <code>summary</code>.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.7.0 - added<br>
3.0.0 - add <code>--exclude-suspended</code></p>
<hr>
<h2 id="email-domain-blocks">Email domain blocks CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/email_domain_blocks.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/email_domain_blocks.rb
</a>

<hr>
<h3 id="email-domain-blocks-list"><code>tootctl email-domain-blocks list</code></h3>
<p>List all currently blocked email domains.</p>
<p><strong>Version history:</strong><br>
3.2.0 - added</p>
<hr>
<h3 id="email-domain-blocks-add"><code>tootctl email-domain-blocks add</code></h3>
<p>Add entries to the email domain blocklist.</p>
<dl>
<dt><code>DOMAIN[...]</code></dt>
<dd>Email domains to block, separated by space. <span class="api-method-parameter-required">required</span></dd>
<dt><code>--with-dns-records</code></dt>
<dd>If provided, will also lookup A, AAAA, and MX records and block them as well.</dd>
</dl>
<p><strong>Version history:</strong><br>
3.2.0 - added</p>
<hr>
<h3 id="email-domain-blocks-remove"><code>tootctl email-domain-blocks remove</code></h3>
<p>Remove entries from the e-mail domain blocklist.</p>
<dl>
<dt><code>DOMAIN[...]</code></dt>
<dd>Email domains to unblock, separated by space. <span class="api-method-parameter-required">required</span></dd>
</dl>
<p><strong>Version history:</strong><br>
3.2.0 - added</p>
<hr>
<h2 id="emoji">Emoji CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/emoji.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/emoji.rb
</a>

<hr>
<h3 id="emoji-export"><code>tootctl emoji export</code></h3>
<p>Exports custom emoji to <code>export.tar.gz</code> at PATH.</p>
<dl>
<dt><code>PATH</code></dt>
<dd>Path to create a .tar.gz archive containing pictures. <span class="api-method-parameter-required">required</span></dd>
<dt><code>--overwrite</code></dt>
<dd>Overwrite any existing archive at <code>PATH</code>.</dd>
<dt><code>--category CATEGORY</code></dt>
<dd>Export only the specified <code>CATEGORY</code>. If not provided, will export all emoji.</dd>
</dl>
<p><strong>Version history:</strong><br>
3.1.4 - added</p>
<hr>
<h3 id="emoji-import"><code>tootctl emoji import</code></h3>
<p>Imports custom emoji from a .tar.gz archive at a given path. The archive should contain PNG or GIF files no larger than 50KB, and the shortcode will be set equal to the filename minus the extension, with optional prefixes and/or suffixes.</p>
<dl>
<dt><code>PATH</code></dt>
<dd>Path to create a .tar.gz archive containing pictures. <span class="api-method-parameter-required">required</span></dd>
<dt><code>--prefix PREFIX</code></dt>
<dd>Add PREFIX to the beginning of generated shortcodes.</dd>
<dt><code>--suffix SUFFIX</code></dt>
<dd>Add SUFFIX to the end of generated shortcodes.</dd>
<dt><code>--overwrite</code></dt>
<dd>Instead of skipping existing emoji, replace them with any discovered emoji with the same shortcode.</dd>
<dt><code>--category CATEGORY</code></dt>
<dd>Group the processed emoji under CATEGORY in the picker.</dd>
<dt><code>--unlisted</code></dt>
<dd>Processed emoji will not be shown in the emoji picker, but will be usable only by their direct shortcode.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.5.0 - added</p>
<hr>
<h3 id="emoji-purge"><code>tootctl emoji purge</code></h3>
<p>Remove all custom emojis.</p>
<dl>
<dt><code>--remote-only</code></dt>
<dd>If provided, remove only from remote domains.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.8.0 - added<br>
3.1.0 - add <code>--remote-only</code></p>
<hr>
<h2 id="feeds">Feeds CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/feeds.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/feeds.rb
</a>

<hr>
<h3 id="feeds-build"><code>tootctl feeds build</code></h3>
<p>Build home and list feeds for one or all users. Feeds will be built from the database and cached in-memory with Redis. Mastodon manages home feeds for active users automatically.</p>
<dl>
<dt><code>USERNAME</code></dt>
<dd>Local username whose feeds will be regenerated.</dd>
<dt><code>--all</code></dt>
<dd>Can be provided instead of <code>USERNAME</code> to refresh all remote accounts.</dd>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to N=5.</dd>
<dt><code>--verbose</code></dt>
<dd>Print additional information while task is processing.</dd>
<dt><code>--dry-run</code></dt>
<dd>Print expected results only, without performing any actions.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.6.0 - added</p>
<hr>
<h3 id="feeds-clear"><code>tootctl feeds clear</code></h3>
<p>Remove all home and list feeds from Redis.</p>
<p><strong>Version history:</strong><br>
2.6.0 - added</p>
<hr>
<h2 id="maintenance">Maintenance CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/maintenance.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/maintenance.rb
</a>

<hr>
<h3 id="maintenance-fix-duplicates"><code>tootctl maintenance fix-duplicates</code></h3>
<p>Fix corrupted database indexes that may have been caused due to changing collation rules. Deletes or merges duplicate accounts, statuses, emojis, etc. Mastodon has to be stopped to run this task, which will take a long time and may be destructive. This is useful if your database indexes are corrupted because of issues such as <a href="https://wiki.postgresql.org/wiki/Locale_data_changes">https://wiki.postgresql.org/wiki/Locale_data_changes</a>.</p>
<p><strong>Version history:</strong><br>
3.3.0 - added</p>
<hr>
<h2 id="media">Media CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/media.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/media.rb
</a>

<hr>
<h3 id="media-remove"><code>tootctl media remove</code></h3>
<p>Removes locally cached copies of media attachments, avatars or profile headers from other servers. By default, only media attachments are removed.</p>
<dl>
<dt><code>--days N</code></dt>
<dd>How old media attachments have to be before they are removed. In case of avatars and headers, how old the last webfinger request and update to the user has to be before they are removed. Defaults to 7.</dd>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to N=5.</dd>
<dt><code>--prune-profiles</code></dt>
<dd>Instead of media attachments, remove locally cached copies of avatars and headers from other servers. Cannot be combined with <code>--remove-headers</code>.</dd>
<dt><code>--remove-headers</code></dt>
<dd>Instead of media attachments, remove locally cached copies of headers from other servers. Cannot be combined with <code>--prune-profiles</code>.</dd>
<dt><code>--include-follows</code></dt>
<dd>Override the default behavior of <code>--prune-profiles</code> and <code>--remove-headers</code> to remove locally cached copies of avatars (and headers) from other servers, irrespective of follow status (by default, they are only removed from accounts that are not followed by or following anyone locally). Can only be used with <code>--prune-profiles</code> or <code>--remove-headers</code>.</dd>
<dt><code>--verbose</code></dt>
<dd>Print additional information while task is processing.</dd>
<dt><code>--dry-run</code></dt>
<dd>Print expected results only, without performing any actions.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.5.0 - added<br>
2.6.2 - show freed disk space<br>
4.1.0 - added &ndash;prune-profiles, &ndash;remove-headers, and &ndash;include-follows.</p>
<hr>
<h3 id="media-remove-orphans"><code>tootctl media remove-orphans</code></h3>
<p>Scans for files that do not belong to existing media attachments, and remove them. Please mind that some storage providers charge for the necessary API requests to list objects. Also, this operation requires iterating over every single file individually, so it will be slow.</p>
<dl>
<dt><code>--start-after</code></dt>
<dd>The Paperclip attachment key where the loop will start. Use this option if the command was interrupted before.</dd>
<dt><code>--dry-run</code></dt>
<dd>Print expected results only, without performing any actions.</dd>
<dt><code>--prefix</code></dt>
<dd>Traverse only a specific prefix of files in the system.</dd>
<dt><code>--fix-permissions</code></dt>
<dd>Sets S3 ACL to be default according to environment variables.</dd>
</dl>
<p><strong>Version history:</strong><br>
3.1.0 - added<br>
3.1.3 - added <code>--prefix</code><br>
3.3.0 - added <code>--fix-permissions</code></p>
<hr>
<h3 id="media-refresh"><code>tootctl media refresh</code></h3>
<p>Refetch remote media attachments from other servers. You must specify the source of media attachments with either <code>--status</code>, <code>--account</code>, <code>--domain</code>, or <code>--days</code>. If an attachment already exists in the database, it will not be overwritten unless you use <code>--force</code>.</p>
<dl>
<dt><code>--account ACCT</code></dt>
<dd>String <code>username@domain</code> handle of the account</dd>
<dt><code>--domain DOMAIN</code></dt>
<dd>FQDN string</dd>
<dt><code>--status ID</code></dt>
<dd>Local numeric ID of the status in the database.</dd>
<dt><code>--days N</code></dt>
<dd>The number of days to limit this task to.</dd>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to 5.</dd>
<dt><code>--verbose</code></dt>
<dd>Print additional information while task is processing.</dd>
<dt><code>--dry-run</code></dt>
<dd>Print expected results only, without performing any actions.</dd>
<dt><code>--force</code></dt>
<dd>Force redownload the remote resource and overwrite the local attachment.</dd>
</dl>
<p><strong>Version history:</strong><br>
3.0.0 - added<br>
3.0.1 - add <code>--force</code> and skip already downloaded attachments by default<br>
4.0.0 - add <code>--days</code></p>
<hr>
<h3 id="media-usage"><code>tootctl media usage</code></h3>
<p>Calculate disk space consumed by Mastodon.</p>
<p><strong>Version history:</strong>
3.0.1 - added</p>
<hr>
<h3 id="media-lookup"><code>tootctl media lookup</code></h3>
<p>Prompts for a media URL, then looks up the status where the media is displayed.</p>
<p><strong>Version history:</strong><br>
3.1.0 - added</p>
<hr>
<h2 id="preview_cards">Preview Cards CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/preview_cards.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/preview_cards.rb
</a>

<hr>
<h3 id="preview_cards-remove"><code>tootctl preview_cards remove</code></h3>
<p>Remove local thumbnails for preview cards.</p>
<dl>
<dt><code>--days N</code></dt>
<dd>How old media attachments have to be before they are removed. Defaults to 180. (NOTE: it is not recommended to delete preview cards within the last 14 days, because preview cards will not be refetched unless the link is reposted after 2 weeks from last time.)</dd>
<dt><code>--concurrency N</code></dt>
<dd>The number of workers to use for this task. Defaults to N=5.</dd>
<dt><code>--verbose</code></dt>
<dd>Print additional information while task is processing.</dd>
<dt><code>--dry-run</code></dt>
<dd>Print expected results only, without performing any actions.</dd>
<dt><code>--link</code></dt>
<dd>Only delete link-type preview cards; leave video and photo cards untouched.</dd>
</dl>
<p><strong>Version history:</strong><br>
3.0.0 - added</p>
<hr>
<h2 id="search">Search CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/search.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/search.rb
</a>

<hr>
<h3 id="search-deploy"><code>tootctl search deploy</code></h3>
<p>Create or update an Elasticsearch index and populate it. If Elasticsearch is empty, this command will create the necessary indices and then import data from the database into those indices. This command will also upgrade indices if the underlying schema has been changed since the last run.</p>
<dl>
<dt><code>--batch-size</code></dt>
<dd>Defaults to 100. A higher batch size can make Elasticsearch process records more quickly, with less load on the PostgreSQL database, but can increase memory pressure on the Elasticsearch nodes during indexing.</dd>
<dt><code>--only INDEX</code></dt>
<dd>Specify an index name [<code>accounts</code>, <code>tags</code>, <code>statuses</code>] to create or update only that index.</dd>
<dt><code>--concurrency N</code></dt>
<dd>Parallelize execution of the command on multiple threads. Defaults to N=2.</dd>
</dl>
<p><strong>Version history:</strong>
2.8.0 - added<br>
3.0.0 - add <code>--processes</code> for parallelization
3.3.0 - options changed<br>
3.5.0 - add <code>--batch-size</code></p>
<hr>
<h2 id="settings">Settings CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/settings.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/settings.rb
</a>

<hr>
<h3 id="settings-registrations-open"><code>tootctl settings registrations open</code></h3>
<p>Opens registrations.</p>
<p><strong>Version history:</strong><br>
2.6.0 - added</p>
<hr>
<h3 id="settings-registrations-close"><code>tootctl settings registrations close</code></h3>
<p>Closes registrations.</p>
<p><strong>Version history:</strong><br>
2.6.0 - added</p>
<hr>
<h3 id="settings-registrations-approved"><code>tootctl settings registrations approved</code></h3>
<p>Set registration to require approval.</p>
<p><strong>Version history:</strong><br>
3.5.2 - added</p>
<dl>
<dt><code>--require_reason</code></dt>
<dd>If true, users must enter a reason when registering.</dd>
</dl>
<hr>
<h2 id="statuses">Statuses CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/statuses.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/statuses.rb
</a>

<hr>
<h3 id="statuses-remove"><code>tootctl statuses remove</code></h3>
<p>Remove unreferenced statuses from the database, such as statuses that came from relays or from users who are no longer followed by any local accounts, and have not been replied to or otherwise interacted with.</p>
<p>This is a computationally heavy procedure that creates extra database indices before commencing, and removes them afterward.</p>
<dl>
<dt><code>--days N</code></dt>
<dd>How old statuses have to be before they are removed. Defaults to 90.</dd>
<dt><code>--skip-media-remove</code></dt>
<dd>Skips removing the media, in case S3 errors out. Defaults to false.</dd>
</dl>
<p><strong>Version history:</strong><br>
2.8.0 - added<br>
3.1.3 - added <code>--skip-media-remove</code><br>
3.5.0 - now removes orphaned records and performs additional cleanup tasks</p>
<hr>
<h2 id="upgrade">Upgrade CLI</h2>
<a href="https://github.com/mastodon/mastodon/blob/main/lib/mastodon/cli/upgrade.rb" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-external-link-square-alt"></i></div>
  lib/mastodon/cli/upgrade.rb
</a>

<hr>
<h3 id="upgrade-storage-schema"><code>tootctl upgrade storage-schema</code></h3>
<p>Upgrade the storage schema to store all non-local media resources in a top-level cache directory. WARNING: This is optional, and only for deployments made before v3.1.4. This command can incur massive object storage costs due to moving potentially terabytes of data.</p>
<dl>
<dt><code>--verbose</code></dt>
<dd>Print additional information while task is processing.</dd>
<dt><code>--dry-run</code></dt>
<dd>Print expected results only, without performing any actions.</dd>
</dl>
<p><strong>Version history:</strong><br>
3.1.4 - added</p>

    






  
  
  
  
    
    
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
      
  
  
  
    
    
    
      
        
          
          
        
        
        
      
    
      
        
          
          
        
        
        
      
    
      
        
          
          
        
        
        
      
    
      
        
          
          
        
        
        
      
    
      
        
          
          
        
        
        
          
            
          
            
          
            
          
            
          
        
      
    
      
        
          
          
        
        
        
      
    
      
        
          
          
            
            
<div style="margin: 30px 0px">
  <a id="previousLink" href="javascript:void(0)" style="font-size: 12pt">
    <i class="fa fa-arrow-left"></i> Page
  </a>
  <div id="pageTurnSpacer" style="display:inline; margin: 0px 50px"></div>  
  <a id="nextLink" href="javascript:void(0)" style="font-size: 12pt">
    Page <i class="fa fa-arrow-right"></i>
  </a>
</div>
          
        
        
        
      
    
      
        
          
          
        
        
        
      
    
      
        
          
          
        
        
        
      
    
      
        
          
          
        
        
        
      
    
      
        
          
          
        
        
        
      
    
      
        
          
          
        
        
        
      
    
      
        
          
          
        
        
        
          
            
          
        
      
    
      
        
          
          
        
        
        
      
      
  
  
  
    
    
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
      
  
  
  
    
    
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
      
  
  
  
    
    
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
      
  
  
  
    
    
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
      
  
  
  
    
    
    
      
        
          
            
            
          
            
            
          
        
      
    
      
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
      
    
      
        
          
                  
        
      
    
      
        
          
            
            
          
            
            
          
            
            
          
        
      
    
      
        
          
            
            
          
            
            
          
            
            
          
            
            
          
        
      
    
      
        
          
            
            
          
        
      
    
      
        
          
                  
        
      
    
      
        
          
            
            
          
            
            
          
            
            
          
            
            
          
        
      
    
      
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
      
  
  
  
    
    
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
    
      
        
          
                  
        
      
      
  


<script>
 
 var previousLink = document.getElementById("previousLink");
 var nextLink = document.getElementById("nextLink");
 var pageTurnSpacer = document.getElementById("pageTurnSpacer");
 
 
 
 var whatIsActive = -1, prevHref, prevName, nextHref, nextName;

 
 var selectNavs = document.getElementsByTagName("nav");
 var selectSidebar;
 for (i = 0; i < selectNavs.length; i++) {
   if (selectNavs[i].className == "sidebar") {
     selectSidebar = selectNavs[i]; 
   }
 }

 
 
 var selectSubMenus = selectSidebar.getElementsByClassName("sub-menu");
 
 var indexActive, indexPrev, indexNext; 
 for (i = 0; i < selectSubMenus.length; i++) {
   let curNavSection = selectSubMenus[i].getElementsByTagName("a");
   
   for (j = 0; j < curNavSection.length; j++) {
     if (curNavSection[j].className == "active") {
      if (j == 0) { 
        prevHref = "remove";    
        nextHref = curNavSection[j+1].href;
        nextName = curNavSection[j+1].innerText;
        whatIsActive = i;
      } else if (j == curNavSection.length - 1) { 
        prevHref = curNavSection[j-1].href;
        prevName = curNavSection[j-1].innerText;
        nextHref = "remove";
        whatIsActive = i;   
      } else { 
        prevHref = curNavSection[j-1].href;
        prevName = curNavSection[j-1].innerText;
        nextHref = curNavSection[j+1].href;
        nextName = curNavSection[j+1].innerText;
        whatIsActive = i;
      }
       break;
     }
   }
   if (whatIsActive != -1) { break; } 
 }
 
 if (prevHref == "remove") {
   previousLink.remove();
   pageTurnSpacer.remove();
   nextLink.href = nextHref;
   nextLink.innerHTML = nextLink.innerHTML.replace("Page", nextName);
 } else if (nextHref == "remove") {
   previousLink.href = prevHref;
   previousLink.innerHTML = previousLink.innerHTML.replace("Page", prevName);
   nextLink.remove();
 } else {
   previousLink.href = prevHref;
   previousLink.innerHTML = previousLink.innerHTML.replace("Page", prevName);
   nextLink.href = nextHref;
   nextLink.innerHTML = nextLink.innerHTML.replace("Page", nextName);
 }
</script>

    <p style="color: #687590;">
      Last updated February 20, 2024 · <a href='https://github.com/mastodon/documentation/tree/main/content/en/admin/tootctl.md' style="color: #687590;">Improve this page</a>

      
        <br />

        Also available in:

        
          <a href="/zh-cn/admin/tootctl/" style="color: #687590;" hreflang="zh-cn">简体中文</a>
        
      
    </p>

  </div>
</main>
  </div>

  <footer class="footer container">
  <div class="sponsorship">
    <div class="container">
      <h2>
        Sponsored by
      </h2>

      <div class="logo-grid">
        <div>
          <a href="https://www.dotcom-monitor.com/es/">
            <img src="/assets/sponsors/dotcom-monitor-logo.png" alt="Dotcom-Monitor" />
          </a>

          <a href="https://www.loadview-testing.com/products/jmeter-load-testing/">
            <img src="/assets/sponsors/LoadView-logo.png" alt="LoadView" />
          </a>

          <a href="http://www.stevetures.com/">
            <img src="/assets/sponsors/stephen-tures.jpg" alt="Stephen Tures" />
          </a>

          <a href="https://swayable.com">
            <img src="/assets/sponsors/swayable.jpeg" alt="Swayable" />
          </a>

          <a href="https://www.sponsormotion.com/">
            <img src="/assets/sponsors/SponsorMotion.png" alt="SponsorMotion" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <p class="legal legal--right">
    <a href='https://joinmastodon.org'>Join Mastodon</a> · <a href='https://blog.joinmastodon.org'>Blog</a> · <a href='https://mastodon.social/@Mastodon' target='_blank'><i class='fab fa-mastodon'></i></a>
  </p>

  <p class="legal"><a href='https://github.com/mastodon/documentation/tree/main/content/en/admin/tootctl.md'>View source</a> · <a href='https://creativecommons.org/licenses/by-sa/4.0/'>CC BY-SA 4.0</a> · <a href='https://joinmastodon.org/imprint'>Imprint</a></p>
</footer>

</body>

</html>
