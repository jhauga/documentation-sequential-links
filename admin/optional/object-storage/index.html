<!DOCTYPE html>
<html lang="en-us">

<head>
  

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>

<link rel="shortcut icon" type="image/png" href="/favicon.ico"/>


<link rel='stylesheet' href='/style.min.0122b8d14d9247c2ac34fa87ad975f23eb927ad958d8ae6bda2caccd9ac9eb42.css'>


<script src='/main.min.db37c27117ff8400e5e30549f6806d2bc825668b596d81316c6148417f59bc72.js' async></script>


  <title>Configuring object storage - Mastodon documentation</title>

  <meta property="og:type" content="article">
  <meta property="og:url" content="https://docs.joinmastodon.org/admin/optional/object-storage/">

  
    <meta name="description" content="Serving user-uploaded files in Mastodon using external object storage">
    <meta property="og:description" content="Serving user-uploaded files in Mastodon using external object storage">
    <meta name="twitter:description" content="Serving user-uploaded files in Mastodon using external object storage">
  

  <meta name="twitter:title" content="Configuring object storage">
  <meta name="twitter:site" content="@joinmastodon">

  <link rel="canonical" href="https://docs.joinmastodon.org/admin/optional/object-storage/">
</head>

<body>
  <div class="container sidebar-layout">
    <nav class="sidebar"><a class="brand" href="/">
  <img class="link-logo" src="/brand.svg" alt="Mastodon" />
</a>

<input id="mobile-nav-toggle" class="mobile-nav-toggle" type="checkbox">
<label for="mobile-nav-toggle">
    <span class="menu-open">
        <i class="fa fa-times"></i> Close
    </span>
    <span class="menu-close">
        <i class="fa fa-bars"></i> Menu
    </span>
</label>

<ul>
  
  
    <li>
      
        <a href="/" class="">What is Mastodon?</a>
      

      
    </li>
  
    <li>
      
        <span class="sub-title">Using Mastodon</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/user/signup/" class="">Signing up for an account</a>

              
            </li>
          
            <li>
              <a href="/user/profile/" class="">Setting up your profile</a>

              
            </li>
          
            <li>
              <a href="/user/posting/" class="">Posting to your profile</a>

              
            </li>
          
            <li>
              <a href="/user/network/" class="">Using the network features</a>

              
            </li>
          
            <li>
              <a href="/user/moderating/" class="">Dealing with unwanted content</a>

              
            </li>
          
            <li>
              <a href="/user/discoverability/" class="">Promoting yourself and others</a>

              
            </li>
          
            <li>
              <a href="/user/preferences/" class="">Set your preferences</a>

              
            </li>
          
            <li>
              <a href="/user/contacts/" class="">More settings</a>

              
            </li>
          
            <li>
              <a href="/user/external/" class="">Using Mastodon externally</a>

              
            </li>
          
            <li>
              <a href="/user/moving/" class="">Moving or leaving accounts</a>

              
            </li>
          
            <li>
              <a href="/user/run-your-own/" class="">Running your own server</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">Running Mastodon</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/admin/prerequisites/" class="">Preparing your machine</a>

              
            </li>
          
            <li>
              <a href="/admin/install/" class="">Installing from source</a>

              
            </li>
          
            <li>
              <a href="/admin/config/" class="">Configuring your environment</a>

              
            </li>
          
            <li>
              <a href="/admin/elasticsearch/" class="">Configuring full-text search</a>

              
            </li>
          
            <li>
              <a href="/admin/optional/" class="">Installing optional features</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/admin/optional/object-storage/" class="active">Configuring object storage</a>
                    </li>
                  
                    <li>
                      <a href="/admin/optional/tor/" class="">Onion services</a>
                    </li>
                  
                    <li>
                      <a href="/admin/optional/sso/" class="">Single Sign On</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/admin/setup/" class="">Setting up your new instance</a>

              
            </li>
          
            <li>
              <a href="/admin/tootctl/" class="">Using the admin CLI</a>

              
            </li>
          
            <li>
              <a href="/admin/upgrading/" class="">Upgrading to a new release</a>

              
            </li>
          
            <li>
              <a href="/admin/backups/" class="">Backing up your server</a>

              
            </li>
          
            <li>
              <a href="/admin/migrating/" class="">Migrating to a new machine</a>

              
            </li>
          
            <li>
              <a href="/admin/scaling/" class="">Scaling up your server</a>

              
            </li>
          
            <li>
              <a href="/admin/moderation/" class="">Moderation actions</a>

              
            </li>
          
            <li>
              <a href="/admin/troubleshooting/" class="">Troubleshooting errors</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/admin/troubleshooting/index-corruption/" class="">Database index corruption</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/admin/roles/" class="">Roles</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">Developing Mastodon apps</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/client/intro/" class="">Getting started with the API</a>

              
            </li>
          
            <li>
              <a href="/client/public/" class="">Playing with public data</a>

              
            </li>
          
            <li>
              <a href="/client/token/" class="">Obtaining client app access</a>

              
            </li>
          
            <li>
              <a href="/client/authorized/" class="">Logging in with an account</a>

              
            </li>
          
            <li>
              <a href="/client/libraries/" class="">Libraries and implementations</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">Contributing to Mastodon</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/dev/overview/" class="">Technical overview</a>

              
            </li>
          
            <li>
              <a href="/dev/setup/" class="">Setting up a dev environment</a>

              
            </li>
          
            <li>
              <a href="/dev/code/" class="">Code structure</a>

              
            </li>
          
            <li>
              <a href="/dev/routes/" class="">Routes</a>

              
            </li>
          
            <li>
              <a href="/dev/disclosure/" class="">Bug bounties and responsible disclosure</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">Spec compliance</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/spec/activitypub/" class="">ActivityPub</a>

              
            </li>
          
            <li>
              <a href="/spec/webfinger/" class="">WebFinger</a>

              
            </li>
          
            <li>
              <a href="/spec/security/" class="">Security</a>

              
            </li>
          
            <li>
              <a href="/spec/microformats/" class="">Microformats</a>

              
            </li>
          
            <li>
              <a href="/spec/oauth/" class="">OAuth</a>

              
            </li>
          
            <li>
              <a href="/spec/bearcaps/" class="">Bearcaps</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">REST API</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/api/guidelines/" class="">Guidelines and best practices</a>

              
            </li>
          
            <li>
              <a href="/api/oauth-scopes/" class="">OAuth Scopes</a>

              
            </li>
          
            <li>
              <a href="/api/rate-limits/" class="">Rate limits</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">API Methods</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/methods/apps/" class="">apps</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/oauth/" class="">oauth</a>
                    </li>
                  
                    <li>
                      <a href="/methods/emails/" class="">emails</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/accounts/" class="">accounts</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/bookmarks/" class="">bookmarks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/favourites/" class="">favourites</a>
                    </li>
                  
                    <li>
                      <a href="/methods/mutes/" class="">mutes</a>
                    </li>
                  
                    <li>
                      <a href="/methods/blocks/" class="">blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/domain_blocks/" class="">domain_blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/filters/" class="">filters</a>
                    </li>
                  
                    <li>
                      <a href="/methods/reports/" class="">reports</a>
                    </li>
                  
                    <li>
                      <a href="/methods/follow_requests/" class="">follow_requests</a>
                    </li>
                  
                    <li>
                      <a href="/methods/endorsements/" class="">endorsements</a>
                    </li>
                  
                    <li>
                      <a href="/methods/featured_tags/" class="">featured_tags</a>
                    </li>
                  
                    <li>
                      <a href="/methods/preferences/" class="">preferences</a>
                    </li>
                  
                    <li>
                      <a href="/methods/followed_tags/" class="">followed_tags</a>
                    </li>
                  
                    <li>
                      <a href="/methods/suggestions/" class="">suggestions</a>
                    </li>
                  
                    <li>
                      <a href="/methods/tags/" class="">tags</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/profile/" class="">profile</a>

              
            </li>
          
            <li>
              <a href="/methods/statuses/" class="">statuses</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/media/" class="">media</a>
                    </li>
                  
                    <li>
                      <a href="/methods/polls/" class="">polls</a>
                    </li>
                  
                    <li>
                      <a href="/methods/scheduled_statuses/" class="">scheduled_statuses</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/timelines/" class="">timelines</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/conversations/" class="">conversations</a>
                    </li>
                  
                    <li>
                      <a href="/methods/lists/" class="">lists</a>
                    </li>
                  
                    <li>
                      <a href="/methods/markers/" class="">markers</a>
                    </li>
                  
                    <li>
                      <a href="/methods/streaming/" class="">streaming</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/notifications/" class="">notifications</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/push/" class="">push</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/search/" class="">search</a>

              
            </li>
          
            <li>
              <a href="/methods/instance/" class="">instance</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/trends/" class="">trends</a>
                    </li>
                  
                    <li>
                      <a href="/methods/directory/" class="">directory</a>
                    </li>
                  
                    <li>
                      <a href="/methods/custom_emojis/" class="">custom_emojis</a>
                    </li>
                  
                    <li>
                      <a href="/methods/announcements/" class="">announcements</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/admin/" class="">admin</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/methods/admin/accounts/" class="">accounts</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/canonical_email_blocks/" class="">canonical_email_blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/dimensions/" class="">dimensions</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/domain_allows/" class="">domain_allows</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/domain_blocks/" class="">domain_blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/email_domain_blocks/" class="">email_domain_blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/ip_blocks/" class="">ip_blocks</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/measures/" class="">measures</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/reports/" class="">reports</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/retention/" class="">retention</a>
                    </li>
                  
                    <li>
                      <a href="/methods/admin/trends/" class="">trends</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/methods/proofs/" class="">proofs</a>

              
            </li>
          
            <li>
              <a href="/methods/oembed/" class="">oembed</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">API Entities</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/entities/Account/" class="">Account</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Account/" class="">Admin::Account</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_CanonicalEmailBlock/" class="">Admin::CanonicalEmailBlock</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Cohort/" class="">Admin::Cohort</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Dimension/" class="">Admin::Dimension</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_DomainAllow/" class="">Admin::DomainAllow</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_DomainBlock/" class="">Admin::DomainBlock</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_EmailDomainBlock/" class="">Admin::EmailDomainBlock</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Ip/" class="">Admin::Ip</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_IpBlock/" class="">Admin::IpBlock</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Measure/" class="">Admin::Measure</a>

              
            </li>
          
            <li>
              <a href="/entities/Admin_Report/" class="">Admin::Report</a>

              
            </li>
          
            <li>
              <a href="/entities/Announcement/" class="">Announcement</a>

              
            </li>
          
            <li>
              <a href="/entities/Application/" class="">Application</a>

              
            </li>
          
            <li>
              <a href="/entities/Context/" class="">Context</a>

              
            </li>
          
            <li>
              <a href="/entities/Conversation/" class="">Conversation</a>

              
            </li>
          
            <li>
              <a href="/entities/CustomEmoji/" class="">CustomEmoji</a>

              
            </li>
          
            <li>
              <a href="/entities/DomainBlock/" class="">DomainBlock</a>

              
            </li>
          
            <li>
              <a href="/entities/Error/" class="">Error</a>

              
            </li>
          
            <li>
              <a href="/entities/ExtendedDescription/" class="">ExtendedDescription</a>

              
            </li>
          
            <li>
              <a href="/entities/FamiliarFollowers/" class="">FamiliarFollowers</a>

              
            </li>
          
            <li>
              <a href="/entities/FeaturedTag/" class="">FeaturedTag</a>

              
            </li>
          
            <li>
              <a href="/entities/Filter/" class="">Filter</a>

              
            </li>
          
            <li>
              <a href="/entities/FilterKeyword/" class="">FilterKeyword</a>

              
            </li>
          
            <li>
              <a href="/entities/FilterResult/" class="">FilterResult</a>

              
            </li>
          
            <li>
              <a href="/entities/FilterStatus/" class="">FilterStatus</a>

              
            </li>
          
            <li>
              <a href="/entities/IdentityProof/" class="">IdentityProof</a>

              
            </li>
          
            <li>
              <a href="/entities/Instance/" class="">Instance</a>

              
            </li>
          
            <li>
              <a href="/entities/List/" class="">List</a>

              
            </li>
          
            <li>
              <a href="/entities/Marker/" class="">Marker</a>

              
            </li>
          
            <li>
              <a href="/entities/MediaAttachment/" class="">MediaAttachment</a>

              
            </li>
          
            <li>
              <a href="/entities/Notification/" class="">Notification</a>

              
            </li>
          
            <li>
              <a href="/entities/Poll/" class="">Poll</a>

              
            </li>
          
            <li>
              <a href="/entities/Preferences/" class="">Preferences</a>

              
            </li>
          
            <li>
              <a href="/entities/PreviewCard/" class="">PreviewCard</a>

              
            </li>
          
            <li>
              <a href="/entities/Reaction/" class="">Reaction</a>

              
            </li>
          
            <li>
              <a href="/entities/Relationship/" class="">Relationship</a>

              
            </li>
          
            <li>
              <a href="/entities/RelationshipSeveranceEvent/" class="">RelationshipSeveranceEvent</a>

              
            </li>
          
            <li>
              <a href="/entities/Report/" class="">Report</a>

              
            </li>
          
            <li>
              <a href="/entities/Role/" class="">Role</a>

              
            </li>
          
            <li>
              <a href="/entities/Rule/" class="">Rule</a>

              
            </li>
          
            <li>
              <a href="/entities/ScheduledStatus/" class="">ScheduledStatus</a>

              
            </li>
          
            <li>
              <a href="/entities/Search/" class="">Search</a>

              
            </li>
          
            <li>
              <a href="/entities/Status/" class="">Status</a>

              
            </li>
          
            <li>
              <a href="/entities/StatusEdit/" class="">StatusEdit</a>

              
            </li>
          
            <li>
              <a href="/entities/StatusSource/" class="">StatusSource</a>

              
            </li>
          
            <li>
              <a href="/entities/Suggestion/" class="">Suggestion</a>

              
            </li>
          
            <li>
              <a href="/entities/Tag/" class="">Tag</a>

              
            </li>
          
            <li>
              <a href="/entities/Token/" class="">Token</a>

              
            </li>
          
            <li>
              <a href="/entities/Translation/" class="">Translation</a>

              
            </li>
          
            <li>
              <a href="/entities/V1_Filter/" class="">V1::Filter</a>

              
            </li>
          
            <li>
              <a href="/entities/V1_Instance/" class="">V1::Instance</a>

              
            </li>
          
            <li>
              <a href="/entities/WebPushSubscription/" class="">WebPushSubscription</a>

              
            </li>
          
        </ul>
      
    </li>
  
</ul>
</nav>
    <main>
  <h1>Configuring object storage</h1>  
  
    <p>Serving user-uploaded files in Mastodon using external object storage</p>
  
  <aside>
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#FS">Using the filesystem</a></li>
        <li><a href="#S3">S3-compatible object storage backends</a>
          <ul>
            <li><a href="#minio">MinIO</a></li>
            <li><a href="#wasabi-object-storage">Wasabi Object Storage</a></li>
            <li><a href="#digitalocean-spaces">DigitalOcean Spaces</a></li>
            <li><a href="#scaleway">Scaleway</a></li>
            <li><a href="#exoscale">Exoscale</a></li>
            <li><a href="#cloudflare-r2">Cloudflare R2</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </aside>
  <div class="e-content">
    <p>User-uploaded files can be stored on the main server&rsquo;s file system, or using an external object storage server, which can be required for scaling.</p>
<h2 id="FS">Using the filesystem</h2>
<p>The simplest way to store user uploads is by using the server&rsquo;s file system. This is how it works by default and is suitable for small servers.</p>
<p>By default, Mastodon will store file uploads under <code>public/system</code> in its installation directory, but that can be overridden using the <code>PAPERCLIP_ROOT_PATH</code> environment variable.</p>
<p>By default, the files are served at <code>https://your-domain/system</code>, which can be overridden using <code>PAPERCLIP_ROOT_URL</code> and <code>CDN_HOST</code>.</p>
<div class="hint hint-info">
  <div class="hint-icon"><i class="fa fa-info-circle"></i></div>

  While using the server&rsquo;s file system is perfectly serviceable for small servers, using external object storage is more scalable.
</div>

<div class="hint hint-danger">
  <div class="hint-icon"><i class="fa fa-exclamation-triangle"></i></div>

  The web server must be configured to serve those files but not allow listing them (that is, <code>https://your-domain/system/</code> should not return a file list). This should be the case if you use the configuration files distributed with Mastodon, but it is worth double-checking.
</div>

<h2 id="S3">S3-compatible object storage backends</h2>
<p>Mastodon can use S3-compatible object storage backends. ACL support is recommended as it allows Mastodon to quickly make the content of temporarily suspended users unavailable, or marginally improve the security of private data.</p>
<p>On Mastodon&rsquo;s end, you need to configure the following environment variables:</p>
<ul>
<li><code>S3_ENABLED=true</code></li>
<li><code>S3_BUCKET=mastodata</code> (replacing <code>mastodata</code> with the name of your bucket)</li>
<li><code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> need to be set to your credentials</li>
<li><code>S3_ALIAS_HOST</code> is optional but highly recommended in order to set up a caching proxy and not lock you to a specific provider</li>
<li><code>S3_REGION</code></li>
<li><code>S3_HOSTNAME</code> (optional if you use Amazon AWS)</li>
<li><code>S3_PERMISSION</code> (optional, if you use a provider that does not support ACLs or want to use custom ACLs)</li>
<li><code>S3_FORCE_SINGLE_REQUEST=true</code> (optional, if you run into trouble processing large files)</li>
</ul>
<a href="/admin/optional/object-storage-proxy/" class="page-ref">
  <div class="page-ref-icon"><i class="fa fa-arrow-right"></i></div>
  Proxying object storage through nginx
</a>
<div class="hint hint-info">
  <div class="hint-icon"><i class="fa fa-info-circle"></i></div>

  You must serve the files with CORS headers, otherwise some functions of Mastodon&rsquo;s web UI will not work. For example, <code>Access-Control-Allow-Origin: *</code>
</div>

<div class="hint hint-danger">
  <div class="hint-icon"><i class="fa fa-exclamation-triangle"></i></div>

  Regardless of the ACL configuration, your S3 bucket must be set up to ensure that all objects are publicly readable but not writable or listable. At the same time, Mastodon itself should have write access to the bucket. This configuration is generally consistent across all S3 providers, and common ones are highlighted below.
</div>

<h3 id="minio">MinIO</h3>
<p>MinIO is an open-source implementation of an S3 object provider. This section does not cover how to install it, but how to configure a bucket for use in Mastodon.</p>
<p>You need to set a policy for anonymous access that allows read-only access to objects contained by the bucket without allowing listing them.</p>
<p>To do this, you need to set a custom policy (replace <code>mastodata</code> with the actual name of your S3 bucket):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
   <span style="color:#ff79c6">&#34;Version&#34;</span>: <span style="color:#f1fa8c">&#34;2012-10-17&#34;</span>,
   <span style="color:#ff79c6">&#34;Statement&#34;</span>: [
      {
         <span style="color:#ff79c6">&#34;Effect&#34;</span>: <span style="color:#f1fa8c">&#34;Allow&#34;</span>,
         <span style="color:#ff79c6">&#34;Principal&#34;</span>: {
           <span style="color:#ff79c6">&#34;AWS&#34;</span>: <span style="color:#f1fa8c">&#34;*&#34;</span>
         },
         <span style="color:#ff79c6">&#34;Action&#34;</span>: <span style="color:#f1fa8c">&#34;s3:GetObject&#34;</span>,
         <span style="color:#ff79c6">&#34;Resource&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:s3:::mastodata/*&#34;</span>
      }
   ]
}
</code></pre></div><p>Mastodon itself needs to be able to write to the bucket, so either use your admin MinIO account (discouraged) or an account specific to Mastodon (recommended) with the following policy attached (replace <code>mastodata</code> with the actual name of your S3 bucket):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#ff79c6">&#34;Version&#34;</span>: <span style="color:#f1fa8c">&#34;2012-10-17&#34;</span>,
    <span style="color:#ff79c6">&#34;Statement&#34;</span>: [
        {
            <span style="color:#ff79c6">&#34;Effect&#34;</span>: <span style="color:#f1fa8c">&#34;Allow&#34;</span>,
            <span style="color:#ff79c6">&#34;Action&#34;</span>: <span style="color:#f1fa8c">&#34;s3:*&#34;</span>,
            <span style="color:#ff79c6">&#34;Resource&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:s3:::mastodata/*&#34;</span>
        }
    ]
}
</code></pre></div><p>You can set those policies from the MinIO Console (web-based user interface) or the command-line client (<code>mcli</code> / <code>mc</code>).</p>
<h4 id="using-the-minio-console">Using the MinIO Console</h4>
<p>Connect to the MinIO Console web interface and create a new bucket (or navigate to your existing bucket):
<img src="/assets/object-storage/minio-bucket.png" alt=""></p>
<p>Then, configure the “Access Policy” to a custom one that allows read access (<code>s3:GetObject</code>) without write access or the ability to list objects (see above):
<img src="/assets/object-storage/minio-access-policy.png" alt=""></p>
<div class="hint hint-info">
  <div class="hint-icon"><i class="fa fa-info-circle"></i></div>

  If the MinIO Console does not allow you to set a “Custom” policy, you will likely need to update MinIO. If you are using MinIO in <em>standalone</em> or <em>filesystem</em> mode, <a href="https://github.com/minio/minio/releases/tag/RELEASE.2022-10-24T18-35-07Z"><code>RELEASE.2022-10-24T18-35-07Z</code></a> should be a safe version to update to that does not require <a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/migrate-fs-gateway.html#migrate-from-gateway-or-filesystem-mode">an involved migration procedure</a>.
</div>

<p>Create a new <code>mastodon-readwrite</code> policy (see above):
<img src="/assets/object-storage/minio-mastodon-readwrite.png" alt=""></p>
<p>Finally, create a new <code>mastodon</code> user with the <code>mastodon-readwrite</code> policy:
<img src="/assets/object-storage/minio-mastodon-user.png" alt=""></p>
<h4 id="using-the-command-line-utility">Using the command-line utility</h4>
<p>The same can be achieved using the <a href="https://min.io/docs/minio/linux/reference/minio-mc.html">MinIO Client</a> command-line utility (which can be called <code>mc</code> or <code>mcli</code> depending on where it is installed from).</p>
<p>Create a new bucket:
<code>mc mb myminio/mastodata</code></p>
<p>Save the anonymous access policy from above as <code>anonymous-readonly-policy.json</code> and the Mastodon user access policy as <code>mastodon-readwrite.json</code> (make sure to replace <code>mastodata</code> with the name of your newly-created bucket).</p>
<p>Set the anonymous access policy for your bucket:
<code>mc anonymous set-json anonymous-readonly-policy.json myminio/mastodata</code></p>
<p>Add a <code>mastodon-readwrite</code> policy:
<code>mc admin policy add myminio mastodon-readwrite mastodon-readwrite.json</code></p>
<p>Add the <code>mastodon</code> user (replace the password):
<code>mc admin user add myminio mastodon SECRET_PASSWORD</code></p>
<p>Apply the <code>mastodon-readwrite</code> policy to the <code>mastodon</code> user:
<code>mc admin policy set myminio mastodon-readwrite user=mastodon</code></p>
<h3 id="wasabi-object-storage">Wasabi Object Storage</h3>
<p>Create a new bucket and define its policy to allow objects to be anonymously readable but not listable:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
   <span style="color:#ff79c6">&#34;Version&#34;</span>: <span style="color:#f1fa8c">&#34;2012-10-17&#34;</span>,
   <span style="color:#ff79c6">&#34;Statement&#34;</span>: [
      {
         <span style="color:#ff79c6">&#34;Effect&#34;</span>: <span style="color:#f1fa8c">&#34;Allow&#34;</span>,
         <span style="color:#ff79c6">&#34;Principal&#34;</span>: {
           <span style="color:#ff79c6">&#34;AWS&#34;</span>: <span style="color:#f1fa8c">&#34;*&#34;</span>
         },
         <span style="color:#ff79c6">&#34;Action&#34;</span>: <span style="color:#f1fa8c">&#34;s3:GetObject&#34;</span>,
         <span style="color:#ff79c6">&#34;Resource&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:s3:::mastodata/*&#34;</span>
      }
   ]
}
</code></pre></div><p><img src="/assets/object-storage/wasabi-access-policy.png" alt=""></p>
<div class="hint hint-info">
  <div class="hint-icon"><i class="fa fa-info-circle"></i></div>

  <p>If you are using an old bucket, ensure you are not giving “Everyone” read access to objects through Wasabi&rsquo;s legacy Access Control settings, as that allows listing objects and take precedence over the IAM policy defined above.</p>
<p><img src="/assets/object-storage/wasabi-access-control.png" alt=""></p>

</div>

<p>Then, create a <code>mastodon-readwrite</code> policy to grant read and write access to your bucket:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#ff79c6">&#34;Version&#34;</span>: <span style="color:#f1fa8c">&#34;2012-10-17&#34;</span>,
    <span style="color:#ff79c6">&#34;Statement&#34;</span>: [
        {
            <span style="color:#ff79c6">&#34;Effect&#34;</span>: <span style="color:#f1fa8c">&#34;Allow&#34;</span>,
            <span style="color:#ff79c6">&#34;Action&#34;</span>: <span style="color:#f1fa8c">&#34;s3:*&#34;</span>,
            <span style="color:#ff79c6">&#34;Resource&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:s3:::mastodata/*&#34;</span>
        }
    ]
}
</code></pre></div><p><img src="/assets/object-storage/wasabi-mastodon-readwrite.png" alt=""></p>
<p>Finally, create a new <code>mastodon</code> user and don&rsquo;t forget to enable the <code>mastodon-readwrite</code> policy:
<img src="/assets/object-storage/wasabi-mastodon-user.png" alt=""></p>
<p>On Mastodon&rsquo;s side, you need to set <code>S3_FORCE_SINGLE_REQUEST=true</code> to properly handle large uploads.</p>
<h3 id="digitalocean-spaces">DigitalOcean Spaces</h3>
<p>In your DigitalOcean Spaces Bucket, make sure that “File Listing” is “Restricted” to users with access keys.</p>
<p><img src="/assets/object-storage/do-spaces.png" alt=""></p>
<h3 id="scaleway">Scaleway</h3>
<p>If you want to use Scaleway Object Storage, we strongly recommend you create a Scaleway project dedicated to your Mastodon instance assets and use a custom IAM policy.</p>
<p>First, create a new Scaleway project, in which you create your object storage bucket. You need to set your bucket visibility to &ldquo;Private&rdquo; to not allow objects to be listed.</p>
<p><img src="/assets/object-storage/scaleway-bucket.png" alt=""></p>
<p>Now that your bucket is created, you need to create API keys to be used in your Mastodon instance configuration.</p>
<p>Head to the IAM settings (in your organization menu, top right of the screen), and create a new IAM policy (eg <code>mastodon-media-access</code>)</p>
<p><img src="/assets/object-storage/scaleway-policy.jpg" alt=""></p>
<p>This policy needs to have one rule, allowing it to read, write and delete objects in the Scaleway project you created above (the scope).</p>
<p><img src="/assets/object-storage/scaleway-policy-rules.jpg" alt=""></p>
<p>Then head to the IAM Applications page, and create a new one (eg <code>my-mastodon-instance</code>) and select the policy you created above.</p>
<p>Finally, click on the application you just created, then &ldquo;API Keys&rdquo;, and create a new API key to use in your instance configuration. You should use the &ldquo;Yes, set up preferred Project&rdquo; option and select the project you created above as the default project for this key.</p>
<p><img src="/assets/object-storage/scaleway-api-key.png" alt=""></p>
<p>Copy the Access Key ID and Secret, and use them for your <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> Mastodon config variables.</p>
<h3 id="exoscale">Exoscale</h3>
<p>In Exoscale, your bucket should not have any read ACLs (Mastodon will set the ACLs on the object themselves as appropriate).</p>
<p>You need to create an API Key for the Mastodon app, restricted to the Object Storage (<code>sos</code>) service, restricted to your bucket, and with unrestricted operations.</p>
<p><img src="/assets/object-storage/exoscale.png" alt=""></p>
<p>On Mastodon&rsquo;s side, you need to set <code>S3_FORCE_SINGLE_REQUEST=true</code> to properly handle large uploads.</p>
<h3 id="cloudflare-r2">Cloudflare R2</h3>
<p>Cloudflare R2 does not support ACLs, so Mastodon needs to be instructed not to try setting them. To do that, set the <code>S3_PERMISSION</code> environment variable to an empty string.</p>
<div class="hint hint-warning">
  <div class="hint-icon"><i class="fa fa-exclamation-circle"></i></div>

  Without support for ACLs, media files from temporarily-suspended users will remain accessible.
</div>

<p>To get credentials for use in Mastodon, select “Manage R2 API Tokens” and create a new API token with “Edit” permissions.</p>
<div class="hint hint-warning">
  <div class="hint-icon"><i class="fa fa-exclamation-circle"></i></div>

  This section is currently under construction.
</div>


    






  
  
    
        
          
  
  
  
    
    
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
  
  
  
    
    
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
                    
        
          
                      
        
            
    
  
  
  
    
    
    
            
    
            
    
            
    
            
    
            
    
  
  
  
    
    
    
            
    
            
    
            
    
            
    
            
    
  
  
  
    
    
    
            
    
            
    
            
    
            
    
            
    
            
    
  
  
  
    
    
    
            
    
            
    
            
    
  
  
  
    
    
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
  
  
  
    
    
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
  

                  
<script>
 
 var previousLink = document.getElementById("previousLink");
 var nextLink = document.getElementById("nextLink");
 var pageTurnSpacer = document.getElementById("pageTurnSpacer");
 var useJS = document.getElementById("useJS");
 
 
 if (useJS.innerHTML == "1") {
   
   var whatIsActive = -1, prevHref, prevName, nextHref, nextName;

   
   var selectNavs = document.getElementsByTagName("nav");
   var selectSidebar;
   for (i = 0; i < selectNavs.length; i++) {
     if (selectNavs[i].className == "sidebar") {
       selectSidebar = selectNavs[i]; 
     }
   }

   
   
   var selectSubMenus = selectSidebar.getElementsByClassName("sub-menu");
   
   var indexActive, indexPrev, indexNext; 
   for (i = 0; i < selectSubMenus.length; i++) {
     let curNavSection = selectSubMenus[i].getElementsByTagName("a");
     
     for (j = 0; j < curNavSection.length; j++) {
       if (curNavSection[j].className == "active") {
        if (j == 0) { 
          prevHref = "remove";    
          nextHref = curNavSection[j+1].href;
          nextName = curNavSection[j+1].innerText;
          whatIsActive = i;
        } else if (j == curNavSection.length - 1) { 
          prevHref = curNavSection[j-1].href;
          prevName = curNavSection[j-1].innerText;
          nextHref = "remove";
          whatIsActive = i;   
        } else { 
          prevHref = curNavSection[j-1].href;
          prevName = curNavSection[j-1].innerText;
          nextHref = curNavSection[j+1].href;
          nextName = curNavSection[j+1].innerText;
          whatIsActive = i;
        }
         break;
       }
     }
     if (whatIsActive != -1) { break; } 
   }
   
   if (prevHref == "remove") {
     previousLink.remove();
     pageTurnSpacer.remove();
     nextLink.href = nextHref;
     nextLink.innerHTML = nextLink.innerHTML.replace("Page", nextName);
   } else if (nextHref == "remove") {
     previousLink.href = prevHref;
     previousLink.innerHTML = previousLink.innerHTML.replace("Page", prevName);
     nextLink.remove();
   } else {
     previousLink.href = prevHref;
     previousLink.innerHTML = previousLink.innerHTML.replace("Page", prevName);
     nextLink.href = nextHref;
     nextLink.innerHTML = nextLink.innerHTML.replace("Page", nextName);
   }
 }
</script>

    <p style="color: #687590;">
      Last updated January 1, 0001 · <a href='https://github.com/mastodon/documentation/tree/main/content/en/admin/optional/object-storage.md' style="color: #687590;">Improve this page</a>

      
    </p>

  </div>
</main>
  </div>

  <footer class="footer container">
  <div class="sponsorship">
    <div class="container">
      <h2>
        Sponsored by
      </h2>

      <div class="logo-grid">
        <div>
          <a href="https://www.dotcom-monitor.com/es/">
            <img src="/assets/sponsors/dotcom-monitor-logo.png" alt="Dotcom-Monitor" />
          </a>

          <a href="https://www.loadview-testing.com/products/jmeter-load-testing/">
            <img src="/assets/sponsors/LoadView-logo.png" alt="LoadView" />
          </a>

          <a href="http://www.stevetures.com/">
            <img src="/assets/sponsors/stephen-tures.jpg" alt="Stephen Tures" />
          </a>

          <a href="https://swayable.com">
            <img src="/assets/sponsors/swayable.jpeg" alt="Swayable" />
          </a>

          <a href="https://www.sponsormotion.com/">
            <img src="/assets/sponsors/SponsorMotion.png" alt="SponsorMotion" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <p class="legal legal--right">
    <a href='https://joinmastodon.org'>Join Mastodon</a> · <a href='https://blog.joinmastodon.org'>Blog</a> · <a href='https://mastodon.social/@Mastodon' target='_blank'><i class='fab fa-mastodon'></i></a>
  </p>

  <p class="legal"><a href='https://github.com/mastodon/documentation/tree/main/content/en/admin/optional/object-storage.md'>View source</a> · <a href='https://creativecommons.org/licenses/by-sa/4.0/'>CC BY-SA 4.0</a> · <a href='https://joinmastodon.org/imprint'>Imprint</a></p>
</footer>

</body>

</html>
